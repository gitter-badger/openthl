<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>development • openthl</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="development">
<meta property="og:description" content="openthl">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">openthl</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/development.html">development</a>
    </li>
    <li>
      <a href="../articles/vignette.html">THL Open API R package</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>development</h1>
            
      
      
      <div class="hidden name"><code>development.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">openthl</span><span class="op">)</span></pre></div>
<div id="about" class="section level2">
<h2 class="hasAnchor">
<a href="#about" class="anchor"></a>About</h2>
<p>This article desribes the phase of development at 2020/10. It describes several perspectives of the THL open data API and the openthl package.</p>
<p>For a description of the API, see <a href="https://yhteistyotilat.fi/wiki08/x/RoCkAQ">THL open data API docs</a>.</p>
</div>
<div id="api-queries-and-general-data-retrieval" class="section level2">
<h2 class="hasAnchor">
<a href="#api-queries-and-general-data-retrieval" class="anchor"></a>API queries and general data retrieval</h2>
<div id="api-data-types" class="section level3">
<h3 class="hasAnchor">
<a href="#api-data-types" class="anchor"></a>API data types</h3>
<p>The API can return the following type of data</p>
<ul>
<li>JSON (API meta information: hrefs and names of datasets)</li>
<li>JSONP (dimensions of a dataset: data labels and classifications)</li>
<li>JSONSTAT (data)</li>
</ul>
</div>
<div id="general-api-queries" class="section level3">
<h3 class="hasAnchor">
<a href="#general-api-queries" class="anchor"></a>General API queries</h3>
<p>The main API interaction is coded in the file <code>api.R</code>. The function <code><a href="../reference/getFromAPI.html">getFromAPI()</a></code> is a general purpose data retrieval function. It takes as parameter the URL and the ‘type’ of the data, which is either ‘meta’ or ‘data’. Depending on the type, the parsing of the response is handled by either jsonlite (meta) or rjstat (data) packages. String manipulation is utilised to handle the JSONP case after which jsonlite is used.</p>
<p>The general idea is that this main retrieval function is called by more specialised functions, which further parse the content into useful formats (eg. data.frames, specialised S3 classes).</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="va">url</span> <span class="op">&lt;-</span> <span class="fu">openthl</span><span class="fu">:::</span><span class="fu">api_data_url</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"epirapo"</span><span class="op">)</span>
<span class="va">reslist</span> <span class="op">&lt;-</span> <span class="fu">openthl</span><span class="fu">:::</span><span class="fu"><a href="../reference/getFromAPI.html">getFromAPI</a></span><span class="op">(</span><span class="va">url</span>, type <span class="op">=</span> <span class="st">"meta"</span><span class="op">)</span>
<span class="va">reslist</span>
<span class="co">#&gt; $link</span>
<span class="co">#&gt; $link$item</span>
<span class="co">#&gt;                                                                                   href</span>
<span class="co">#&gt; 1 https://sampo.thl.fi/pivot/prod/en/epirapo/covid19case/fact_epirapo_covid19case.json</span>
<span class="co">#&gt; 2 https://sampo.thl.fi/pivot/prod/fi/epirapo/covid19case/fact_epirapo_covid19case.json</span>
<span class="co">#&gt; 3 https://sampo.thl.fi/pivot/prod/sv/epirapo/covid19case/fact_epirapo_covid19case.json</span>
<span class="co">#&gt; 4   https://sampo.thl.fi/pivot/prod/en/epirapo/omaolosymp/fact_epirapo_omaolosymp.json</span>
<span class="co">#&gt; 5   https://sampo.thl.fi/pivot/prod/fi/epirapo/omaolosymp/fact_epirapo_omaolosymp.json</span>
<span class="co">#&gt; 6   https://sampo.thl.fi/pivot/prod/sv/epirapo/omaolosymp/fact_epirapo_omaolosymp.json</span>
<span class="co">#&gt;                                                          label   class</span>
<span class="co">#&gt; 1           COVID-19 cases in the infectious diseases registry dataset</span>
<span class="co">#&gt; 2                   Tartuntatautirekisterin COVID-19-tapaukset dataset</span>
<span class="co">#&gt; 3 Antal fall av COVID-19 i registret över smittsamma sjukdomar dataset</span>
<span class="co">#&gt; 4                              Self-reported COVID-19 symptoms dataset</span>
<span class="co">#&gt; 5                                  Itseilmoitetut koronaoireet dataset</span>
<span class="co">#&gt; 6                            Självrapporterade COVID-19 symtom dataset</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $label</span>
<span class="co">#&gt; [1] "epirapo"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $version</span>
<span class="co">#&gt; [1] "2.0"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $class</span>
<span class="co">#&gt; [1] "collection"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $updated</span>
<span class="co">#&gt; [1] "2020-11-02"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "api_response"</span>
<span class="co">#&gt; attr(,"url")</span>
<span class="co">#&gt; [1] "https://sampo.thl.fi/pivot/prod/api/epirapo.json"</span>
<span class="co">#&gt; attr(,"api-url")</span>
<span class="co">#&gt; [1] "https://sampo.thl.fi/pivot/prod/api"</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "character"    "api-data-url"</span>
<span class="co">#&gt; attr(,"status")</span>
<span class="co">#&gt; [1] 200</span></pre></div>
</div>
<div id="api-urls" class="section level3">
<h3 class="hasAnchor">
<a href="#api-urls" class="anchor"></a>API URL’s</h3>
<p>There are two public base URLs for the API: beta and prod.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="fu">openthl</span><span class="fu">:::</span><span class="fu">url_base</span><span class="op">(</span>type <span class="op">=</span> <span class="st">"prod"</span><span class="op">)</span> <span class="co"># default</span>
<span class="co">#&gt; [1] "https://sampo.thl.fi/pivot/prod/"</span>
<span class="fu">openthl</span><span class="fu">:::</span><span class="fu">url_base</span><span class="op">(</span><span class="st">"beta"</span><span class="op">)</span>
<span class="co">#&gt; [1] "https://sampo.thl.fi/pivot/beta/"</span></pre></div>
<p>The URL to the API is given by</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="fu"><a href="../reference/url_api.html">url_api</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"prod"</span><span class="op">)</span> <span class="co"># default</span>
<span class="co">#&gt; [1] "https://sampo.thl.fi/pivot/prod/api"</span></pre></div>
<p>The function <code>api_data_url()</code> builds URLs which can be queried by <code><a href="../reference/getFromAPI.html">getFromAPI()</a></code>. The result is a character vector which has as an attribute the main API URL. It also has the S3 class “api-data-url”.</p>
<p>The API can return csv or json type data, but I think it would make sense for the R package to only interact with JSON.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="fu">openthl</span><span class="fu">:::</span><span class="fu">api_data_url</span><span class="op">(</span><span class="st">"epirapo"</span>, format <span class="op">=</span> <span class="st">"json"</span><span class="op">)</span>
<span class="co">#&gt; [1] "https://sampo.thl.fi/pivot/prod/api/epirapo.json"</span>
<span class="co">#&gt; attr(,"api-url")</span>
<span class="co">#&gt; [1] "https://sampo.thl.fi/pivot/prod/api"</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "character"    "api-data-url"</span></pre></div>
<p>Relevant source codes:</p>
<ul>
<li>api.R</li>
<li>urls.R</li>
</ul>
<p><em>Development thoughts</em>:</p>
<ul>
<li>There is currently no clear plan on how to query the beta API.</li>
<li>the scope of the package could maybe be restricted to JSON data and hence all function arguments related to the format may not be needed.</li>
</ul>
</div>
</div>
<div id="api-exploration-and-user-starting-point" class="section level2">
<h2 class="hasAnchor">
<a href="#api-exploration-and-user-starting-point" class="anchor"></a>API exploration and user starting point</h2>
<div id="api-terminology" class="section level3">
<h3 class="hasAnchor">
<a href="#api-terminology" class="anchor"></a>API terminology</h3>
<p>The API terminology includes the following hierarchy</p>
<ul>
<li>aihealue (subject)</li>
<li>hydra (hydra)</li>
<li>kuutio (cube)</li>
</ul>
<p>The subject is a bit like a schema. A single subject can include multiple hydras. A single hydra can include multiple cubes. A cube is a dataset with labels according to a single language. I believe that there are always as many cubes in the hydra as there are translations to the dataset.</p>
</div>
<div id="user-interaction-with-the-terminology" class="section level3">
<h3 class="hasAnchor">
<a href="#user-interaction-with-the-terminology" class="anchor"></a>User interaction with the terminology</h3>
<p><code><a href="../reference/thlHydra.html">thlSubject()</a></code> lists all cubes belonging to a subject</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="va">subject</span> <span class="op">&lt;-</span> <span class="st">"epirapo"</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/thlHydra.html">thlSubject</a></span><span class="op">(</span><span class="va">subject</span><span class="op">)</span>
<span class="va">x</span>
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt;   href                                 label                          class</span>
<span class="co">#&gt; * &lt;chr&gt;                                &lt;chr&gt;                          &lt;chr&gt;</span>
<span class="co">#&gt; 1 https://sampo.thl.fi/pivot/prod/en/… COVID-19 cases in the infecti… data…</span>
<span class="co">#&gt; 2 https://sampo.thl.fi/pivot/prod/fi/… Tartuntatautirekisterin COVID… data…</span>
<span class="co">#&gt; 3 https://sampo.thl.fi/pivot/prod/sv/… Antal fall av COVID-19 i regi… data…</span>
<span class="co">#&gt; 4 https://sampo.thl.fi/pivot/prod/en/… Self-reported COVID-19 sympto… data…</span>
<span class="co">#&gt; 5 https://sampo.thl.fi/pivot/prod/fi/… Itseilmoitetut koronaoireet    data…</span>
<span class="co">#&gt; 6 https://sampo.thl.fi/pivot/prod/sv/… Självrapporterade COVID-19 sy… data…</span></pre></div>
<p><code><a href="../reference/thlHydra.html">thlDatasets()</a></code> takes the output of <code><a href="../reference/thlHydra.html">thlSubject()</a></code> and presents the same information, but parses the hrefs into columns. There is probably no good reason why <code><a href="../reference/thlHydra.html">thlDatasets()</a></code> could not simply accept the subject character name as input, but currently it only accepts the object returned by <code><a href="../reference/thlHydra.html">thlSubject()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="fu"><a href="../reference/thlHydra.html">thlDatasets</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="co">#&gt;                           base_url lang subject       hydra</span>
<span class="co">#&gt; 1 https://sampo.thl.fi/pivot/prod/   en epirapo covid19case</span>
<span class="co">#&gt; 2 https://sampo.thl.fi/pivot/prod/   fi epirapo covid19case</span>
<span class="co">#&gt; 3 https://sampo.thl.fi/pivot/prod/   sv epirapo covid19case</span>
<span class="co">#&gt; 4 https://sampo.thl.fi/pivot/prod/   en epirapo  omaolosymp</span>
<span class="co">#&gt; 5 https://sampo.thl.fi/pivot/prod/   fi epirapo  omaolosymp</span>
<span class="co">#&gt; 6 https://sampo.thl.fi/pivot/prod/   sv epirapo  omaolosymp</span>
<span class="co">#&gt;                  cube</span>
<span class="co">#&gt; 1 epirapo_covid19case</span>
<span class="co">#&gt; 2 epirapo_covid19case</span>
<span class="co">#&gt; 3 epirapo_covid19case</span>
<span class="co">#&gt; 4  epirapo_omaolosymp</span>
<span class="co">#&gt; 5  epirapo_omaolosymp</span>
<span class="co">#&gt; 6  epirapo_omaolosymp</span></pre></div>
<p><code><a href="../reference/thlHydra.html">thlHydra()</a></code> takes a subject name and a hydra name and returns hrefs to the cubes (datasets) in that hydra. For example, the hydra covid19case is translated into fi, en and sv, so it has 3 cubes.</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="fu"><a href="../reference/thlHydra.html">thlHydra</a></span><span class="op">(</span><span class="va">subject</span>, hydra <span class="op">=</span> <span class="st">"covid19case"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt;   href                                 label                          class</span>
<span class="co">#&gt; * &lt;chr&gt;                                &lt;chr&gt;                          &lt;chr&gt;</span>
<span class="co">#&gt; 1 https://sampo.thl.fi/pivot/prod/en/… COVID-19 cases in the infecti… data…</span>
<span class="co">#&gt; 2 https://sampo.thl.fi/pivot/prod/fi/… Tartuntatautirekisterin COVID… data…</span>
<span class="co">#&gt; 3 https://sampo.thl.fi/pivot/prod/sv/… Antal fall av COVID-19 i regi… data…</span></pre></div>
<p><em>Development thoughts</em>:</p>
<ul>
<li>It is a bit unclear what should be the starting point for the user. Is it an url to a cube? Is it an URL to a hydra? Is it the name of the subject and hydra?</li>
<li>thlDatasets should probably take as input the subject name (i.e. call thlSubject() internally first)</li>
</ul>
<p>Main functionality source file location: <code>retrieve.R</code></p>
</div>
</div>
<div id="cube-dimensions-labels-and-metadata" class="section level2">
<h2 class="hasAnchor">
<a href="#cube-dimensions-labels-and-metadata" class="anchor"></a>Cube dimensions: labels and metadata</h2>
<div id="dimensions" class="section level3">
<h3 class="hasAnchor">
<a href="#dimensions" class="anchor"></a>Dimensions</h3>
<p>A single dimension in the cube is a hierarchical structure with multiple stages. An example is Area with stages hospital district (stage 1) and municipality (stage 2).</p>
</div>
<div id="thlcube-object" class="section level3">
<h3 class="hasAnchor">
<a href="#thlcube-object" class="anchor"></a>thlCube object</h3>
<p>the thlCube function now returns an object which includes</p>
<ul>
<li>url: the url of the cube (fact url), which is also the argument of thlCube</li>
<li>dimensions: A list of data frames which include the complete hierarchy of each of the dimensions in the dataset (including also measures).</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">openthl</span><span class="op">)</span>
<span class="va">urls</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/thlHydra.html">thlHydra</a></span><span class="op">(</span><span class="st">"toitu"</span>, <span class="st">"ennakko3"</span><span class="op">)</span>
<span class="va">url</span> <span class="op">&lt;-</span> <span class="va">urls</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="co"># fi href</span>
<span class="va">cube</span> <span class="op">&lt;-</span> <span class="fu">openthl</span><span class="fu">::</span><span class="fu"><a href="../reference/thlCube.html">thlCube</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">cube</span><span class="op">$</span><span class="va">dimensions</span><span class="op">)</span>
<span class="co">#&gt; [1] "area"     "time"     "provider" "measure"</span></pre></div>
</div>
<div id="dimensions-object" class="section level3">
<h3 class="hasAnchor">
<a href="#dimensions-object" class="anchor"></a>Dimensions object</h3>
<p>The hierarchical dimension information is presented as a wide format data frame. The prefix in the column names indicates the stage. There is a single row per a unique label in the highest hierarchy level. In the example below the highest hierarchy level is municipality, so there are 311 rows (number of municipalities) in the dimension data.frame.</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">cube</span><span class="op">$</span><span class="va">dimensions</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co"># first dimension</span>
<span class="co">#&gt; Classes 'hydra_dimension_df' and 'data.frame':   311 obs. of  22 variables:</span>
<span class="co">#&gt;  $ stage1_id       : chr  "165820" "165820" "165820" "165820" ...</span>
<span class="co">#&gt;  $ stage1_sid      : int  292857 292857 292857 292857 292857 292857 292857 292857 292857 292857 ...</span>
<span class="co">#&gt;  $ stage1_label    : chr  "Etelä-Suomen AVI" "Etelä-Suomen AVI" "Etelä-Suomen AVI" "Etelä-Suomen AVI" ...</span>
<span class="co">#&gt;  $ stage1_stage    : chr  "avi" "avi" "avi" "avi" ...</span>
<span class="co">#&gt;  $ stage1_code     : chr  "1" "1" "1" "1" ...</span>
<span class="co">#&gt;  $ stage1_sort     : int  367183 367183 367183 367183 367183 367183 367183 367183 367183 367183 ...</span>
<span class="co">#&gt;  $ stage1_uri      : chr  "http://meta.thl.fi/codes/wild/dimension/area/avi/1" "http://meta.thl.fi/codes/wild/dimension/area/avi/1" "http://meta.thl.fi/codes/wild/dimension/area/avi/1" "http://meta.thl.fi/codes/wild/dimension/area/avi/1" ...</span>
<span class="co">#&gt;  $ stage1_parent_id: chr  "400" "400" "400" "400" ...</span>
<span class="co">#&gt;  $ stage2_id       : chr  "165827" "165827" "165827" "165827" ...</span>
<span class="co">#&gt;  $ stage2_sid      : int  210938 210938 210938 210938 210938 210938 210938 210938 210938 210938 ...</span>
<span class="co">#&gt;  $ stage2_label    : chr  "Uusimaa" "Uusimaa" "Uusimaa" "Uusimaa" ...</span>
<span class="co">#&gt;  $ stage2_stage    : chr  "region" "region" "region" "region" ...</span>
<span class="co">#&gt;  $ stage2_code     : chr  "01" "01" "01" "01" ...</span>
<span class="co">#&gt;  $ stage2_sort     : int  367126 367126 367126 367126 367126 367126 367126 367126 367126 367126 ...</span>
<span class="co">#&gt;  $ stage2_uri      : chr  "http://meta.thl.fi/codes/wild/dimension/area/region/01" "http://meta.thl.fi/codes/wild/dimension/area/region/01" "http://meta.thl.fi/codes/wild/dimension/area/region/01" "http://meta.thl.fi/codes/wild/dimension/area/region/01" ...</span>
<span class="co">#&gt;  $ stage3_id       : chr  "165850" "165857" "165872" "165878" ...</span>
<span class="co">#&gt;  $ stage3_sid      : int  301842 301863 302004 175740 301961 301768 302003 301995 301759 301971 ...</span>
<span class="co">#&gt;  $ stage3_label    : chr  "Askola" "Espoo" "Hanko" "Helsinki" ...</span>
<span class="co">#&gt;  $ stage3_stage    : chr  "municipality" "municipality" "municipality" "municipality" ...</span>
<span class="co">#&gt;  $ stage3_code     : chr  "018" "049" "078" "091" ...</span>
<span class="co">#&gt;  $ stage3_sort     : int  366192 366199 366214 366221 366228 366239 366254 366265 366271 366279 ...</span>
<span class="co">#&gt;  $ stage3_uri      : chr  "http://meta.thl.fi/codes/wild/dimension/area/municipality/018" "http://meta.thl.fi/codes/wild/dimension/area/municipality/049" "http://meta.thl.fi/codes/wild/dimension/area/municipality/078" "http://meta.thl.fi/codes/wild/dimension/area/municipality/091" ...</span>
<span class="co">#&gt;  - attr(*, "root")='data.frame': 1 obs. of  9 variables:</span>
<span class="co">#&gt;   ..$ id        : chr "400"</span>
<span class="co">#&gt;   ..$ sid       : int 2079</span>
<span class="co">#&gt;   ..$ label     : chr "AVI yhteensä"</span>
<span class="co">#&gt;   ..$ stage     : chr "root"</span>
<span class="co">#&gt;   ..$ code      : chr "Avi_yht"</span>
<span class="co">#&gt;   ..$ sort      : int 1</span>
<span class="co">#&gt;   ..$ uri       : chr "http://meta.thl.fi/codes/wild/dimension/area/root"</span>
<span class="co">#&gt;   ..$ properties:'data.frame':   1 obs. of  1 variable:</span>
<span class="co">#&gt;   .. ..$ is: chr "area/root"</span>
<span class="co">#&gt;   ..$ parent_id : chr "area"</span>
<span class="co">#&gt;  - attr(*, "nstage")= num 3</span></pre></div>
</div>
<div id="dimension-retrieval-and-parsing" class="section level3">
<h3 class="hasAnchor">
<a href="#dimension-retrieval-and-parsing" class="anchor"></a>Dimension retrieval and parsing</h3>
<p>The function <code>get_dimensions</code> queries the API for dimension information.</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://sampo.thl.fi/pivot/prod/en/epirapo/covid19case/fact_epirapo_covid19case.json"</span>
<span class="va">dimensions</span> <span class="op">&lt;-</span> <span class="fu">openthl</span><span class="fu">:::</span><span class="fu"><a href="../reference/get_dimensions.html">get_dimensions</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="co"># list</span></pre></div>
<p>The function <code><a href="../reference/parse_dimensions.html">parse_dimensions()</a></code> parses all dimensions as a list of data frames (each with S3 class ‘hydra_dimension_df’)</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="co"># parse all dimensions as a list of data frames (each with S3 class 'hydra_dimension_df')</span>
<span class="va">DF</span> <span class="op">&lt;-</span> <span class="fu">openthl</span><span class="fu">:::</span><span class="fu"><a href="../reference/parse_dimensions.html">parse_dimensions</a></span><span class="op">(</span><span class="va">dimensions</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">DF</span><span class="op">)</span>
<span class="co">#&gt; [1] "hcdmunicipality2020"      "dateweek2020010120201231"</span>
<span class="co">#&gt; [3] "ttr10yage"                "sex"                     </span>
<span class="co">#&gt; [5] "measure"</span></pre></div>
<p><code><a href="../reference/parse_dimensions.html">parse_dimensions()</a></code> uses <code><a href="../reference/getHierarchy.html">getHierarchy()</a></code>, which parses a single dimension as a data frame.</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="co"># parse a single dimension as a data frame</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">openthl</span><span class="fu">:::</span><span class="fu"><a href="../reference/getHierarchy.html">getHierarchy</a></span><span class="op">(</span><span class="va">dimensions</span><span class="op">$</span><span class="va">children</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, parent_id <span class="op">=</span> <span class="va">dimensions</span><span class="op">$</span><span class="va">id</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="co">#&gt; 'data.frame':    310 obs. of  15 variables:</span>
<span class="co">#&gt;  $ stage1_id       : chr  "hcdmunicipality20202" "hcdmunicipality20202" "hcdmunicipality20202" "hcdmunicipality20202" ...</span>
<span class="co">#&gt;  $ stage1_sid      : int  445131 445131 445131 445131 445131 445131 445131 445131 445131 445131 ...</span>
<span class="co">#&gt;  $ stage1_label    : chr  "Åland" "Åland" "Åland" "Åland" ...</span>
<span class="co">#&gt;  $ stage1_stage    : chr  "hcd" "hcd" "hcd" "hcd" ...</span>
<span class="co">#&gt;  $ stage1_code     : chr  "hcdmunicipality20202" "hcdmunicipality20202" "hcdmunicipality20202" "hcdmunicipality20202" ...</span>
<span class="co">#&gt;  $ stage1_sort     : int  2 2 2 2 2 2 2 2 2 2 ...</span>
<span class="co">#&gt;  $ stage1_uri      : chr  "http://meta.thl.fi/codes/wild/dimension/hcdmunicipality2020/1/hcd/2" "http://meta.thl.fi/codes/wild/dimension/hcdmunicipality2020/1/hcd/2" "http://meta.thl.fi/codes/wild/dimension/hcdmunicipality2020/1/hcd/2" "http://meta.thl.fi/codes/wild/dimension/hcdmunicipality2020/1/hcd/2" ...</span>
<span class="co">#&gt;  $ stage1_parent_id: chr  "hcdmunicipality20201" "hcdmunicipality20201" "hcdmunicipality20201" "hcdmunicipality20201" ...</span>
<span class="co">#&gt;  $ stage2_id       : chr  "hcdmunicipality202023" "hcdmunicipality202024" "hcdmunicipality202025" "hcdmunicipality202026" ...</span>
<span class="co">#&gt;  $ stage2_sid      : int  445268 444988 445090 445231 445227 445124 445080 445266 445153 445091 ...</span>
<span class="co">#&gt;  $ stage2_label    : chr  "Brändö" "Eckerö" "Finström" "Föglö" ...</span>
<span class="co">#&gt;  $ stage2_stage    : chr  "municipality" "municipality" "municipality" "municipality" ...</span>
<span class="co">#&gt;  $ stage2_code     : chr  "hcdmunicipality202023" "hcdmunicipality202024" "hcdmunicipality202025" "hcdmunicipality202026" ...</span>
<span class="co">#&gt;  $ stage2_sort     : int  23 24 25 26 27 28 29 30 31 32 ...</span>
<span class="co">#&gt;  $ stage2_uri      : chr  "http://meta.thl.fi/codes/wild/dimension/hcdmunicipality2020/1/municipality/23" "http://meta.thl.fi/codes/wild/dimension/hcdmunicipality2020/1/municipality/24" "http://meta.thl.fi/codes/wild/dimension/hcdmunicipality2020/1/municipality/25" "http://meta.thl.fi/codes/wild/dimension/hcdmunicipality2020/1/municipality/26" ...</span>
<span class="co">#&gt;  - attr(*, "root")='data.frame': 1 obs. of  8 variables:</span>
<span class="co">#&gt;   ..$ id       : chr "hcdmunicipality20201"</span>
<span class="co">#&gt;   ..$ sid      : int 445222</span>
<span class="co">#&gt;   ..$ label    : chr "All areas"</span>
<span class="co">#&gt;   ..$ stage    : chr "root"</span>
<span class="co">#&gt;   ..$ code     : chr "hcdmunicipality20201"</span>
<span class="co">#&gt;   ..$ sort     : int 1</span>
<span class="co">#&gt;   ..$ uri      : chr "http://meta.thl.fi/codes/wild/dimension/hcdmunicipality2020/1/root/1"</span>
<span class="co">#&gt;   ..$ parent_id: chr "hcdmunicipality2020"</span>
<span class="co">#&gt;  - attr(*, "nstage")= num 2</span></pre></div>
</div>
</div>
<div id="data-retrieval" class="section level2">
<h2 class="hasAnchor">
<a href="#data-retrieval" class="anchor"></a>Data retrieval</h2>
<div id="backend" class="section level3">
<h3 class="hasAnchor">
<a href="#backend" class="anchor"></a>Backend</h3>
<p>Data retriaval and parsing is largely unimplemented. The general data retriaval function with type ‘data’ should be tested and parsing implemented.</p>
</div>
<div id="user-interface" class="section level3">
<h3 class="hasAnchor">
<a href="#user-interface" class="anchor"></a>User interface</h3>
<p>Methods could be written which utilise the object returned by <code><a href="../reference/thlCube.html">openthl::thlCube</a></code>, which contains the dimension meta informantion, to build queries which</p>
<ul>
<li>retrieve data</li>
<li>adds labels to the data</li>
</ul>
<p>For example the following methods could be implemented:</p>
<ul>
<li>select() (builds a query which chooses dimensions/measures)</li>
<li>filter() (adds a filter to the query)</li>
<li>collect() (retrieves the data)</li>
</ul>
<p>Some choices need to be made regarding how the user refers to the dimensions and measures, i.e. whether to use ID’s or labels. It may make sense to use ID’s when select():ing. A stage could be referred to by for example <dimension_id>.<stage_id>. This needs some consideration and exploration on what is most straight forward.</stage_id></dimension_id></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Tuomo Nieminen, Leo Lahti.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
